

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weighting &mdash; SExtractor 2.28.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=cfc9bc01" />

  
    <link rel="shortcut icon" href="_static/astromaticO.png"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=fb101e21"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Flagging" href="Flagging.html" />
    <link rel="prev" title="Modeling the background" href="Background.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            SExtractor
              <img src="_static/cover.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="License.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installing.html">Installing the software</a></li>
<li class="toctree-l1"><a class="reference internal" href="Using.html">Using SExtractor</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Processing.html">Processing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Background.html">Modeling the background</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Weighting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#weight-map-formats">Weight-map formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="#effect-of-weighting">Effect of weighting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#combining-weight-maps">Combining weight maps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#weight-map-flags-flags-weight">Weight-map flags: <span class="param">FLAGS_WEIGHT</span></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Flagging.html">Flagging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Measurements.html">Measurements</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SExtractor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="Processing.html">Processing</a></li>
      <li class="breadcrumb-item active">Weighting</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Weighting.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="weighting">
<h1>Weighting<a class="headerlink" href="#weighting" title="Link to this heading"></a></h1>
<p>The noise level in astronomical images is often fairly constant, that is, constant values for the gain, the background noise and the detection thresholds can be used over the whole frame.
Unfortunately in some cases, like strongly vignetted or composited images, this approximation is no longer good enough.
This leads to detecting clusters of detected noise peaks in the noisiest parts of the image, or missing obvious objects in the most sensitive ones.
<strong class="program">SExtractor</strong> is able to handle images with variable noise.
It does it through <em>weight maps</em>, which are frames having the same size as the images where objects are detected or measured, and which describe the noise intensity at each pixel.
These maps are internally stored in units of <em>absolute variance</em> (in <span class="math notranslate nohighlight">\(ADU^2\)</span>)
We employ the generic term <em>weight map</em> because these maps can also be interpreted as quality index maps: infinite variance (<span class="math notranslate nohighlight">\(\ge 10^{30}\)</span> by definition in <strong class="program">SExtractor</strong>) means that the related pixel in the science frame is totally unreliable and should be ignored.
The variance format was adopted as it linearizes most of the operations done over weight maps (see below).</p>
<p>This means that the noise covariances between pixels are ignored. Although raw CCD images have essentially white noise, this is not the case for warped images, for which resampling may induce a strong correlation between neighboring pixels.
In theory, all non-zero covariances within the geometrical limits of the analysed patterns should be taken into account to derive thresholds or error estimates.
Fortunately, the correlation length of the noise is often smaller than the patterns to be detected or measured, and constant over the image.
In that case one can apply a simple <em>fudge factor</em> to the estimated variance to account for correlations on small scales.
This proves to be a good approximation in general, although it certainly leads to underestimations for the smallest patterns.</p>
<section id="weight-map-formats">
<span id="weight-map-format"></span><h2>Weight-map formats<a class="headerlink" href="#weight-map-formats" title="Link to this heading"></a></h2>
<p><strong class="program">SExtractor</strong> accepts in input, and converts to its internal variance format, several types of weight-maps.
This is controlled through the <code class="docutils literal notranslate"><span class="pre">WEIGHT_TYPE</span></code> configuration keyword.
Those weight-maps can either be read from a FITS file, whose name is specified by the <code class="docutils literal notranslate"><span class="pre">WEIGHT_IMAGE</span></code> keyword, or computed internally.
Valid <code class="docutils literal notranslate"><span class="pre">WEIGHT_TYPE</span></code> values are:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">NONE</span></code> :</dt><dd><p>No weighting is applied.
The related <code class="docutils literal notranslate"><span class="pre">WEIGHT_IMAGE</span></code> and <code class="docutils literal notranslate"><span class="pre">WEIGHT_THRESH</span></code> (see below) parameters are ignored.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">BACKGROUND</span></code> :</dt><dd><p>The science image itself is used to compute internally a variance map (the related <code class="docutils literal notranslate"><span class="pre">WEIGHT_IMAGE</span></code> parameter is ignored).
Robust (<span class="math notranslate nohighlight">\(3\sigma\)</span>-clipped) variance estimates are first computed within the same background meshes as the <a class="reference internal" href="Background.html#background-model"><span class="std std-ref">background model</span></a> <a class="footnote-reference brackets" href="#f1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.
The resulting low-resolution variance map is then bicubic-spline-interpolated on the fly to produce the actual full-size variance map.
A check-image with <code class="docutils literal notranslate"><span class="pre">CHECKIMAGE_TYPE</span></code> <code class="docutils literal notranslate"><span class="pre">MINIBACK_RMS</span></code> can be requested to examine the low-resolution variance map.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">MAP_RMS</span></code> :</dt><dd><p>The FITS image specified by the <code class="docutils literal notranslate"><span class="pre">WEIGHT_IMAGE</span></code> file name must contain a weight-map in units of absolute standard deviations (in ADUs per pixel).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">MAP_VAR</span></code> :</dt><dd><p>The FITS image specified by the <code class="docutils literal notranslate"><span class="pre">WEIGHT_IMAGE</span></code> file name must contain a weight-map in units of relative variance.
A robust scaling to the appropriate absolute level is then performed by comparing this variance map to an internal, low-resolution, absolute variance map built from the science image itself.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">MAP_WEIGHT</span></code> :</dt><dd><p>The FITS image specified by the <code class="docutils literal notranslate"><span class="pre">WEIGHT_IMAGE</span></code> file name must contain a weight-map in units of relative weights.
The data are converted to variance units (by definition variance <span class="math notranslate nohighlight">\(\propto\frac{1}{weight}\)</span>), and scaled as for <code class="docutils literal notranslate"><span class="pre">MAP_VAR</span></code>.
<code class="docutils literal notranslate"><span class="pre">MAP_WEIGHT</span></code> is the most commonly used type of weight-map: a flat-field, for example, is generally a good approximation to a perfect weight-map.</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="effect-of-weighting">
<span id="id2"></span><h2>Effect of weighting<a class="headerlink" href="#effect-of-weighting" title="Link to this heading"></a></h2>
<p>Weight-maps modify the working of <strong class="program">SExtractor</strong> in the following respects:</p>
<ol class="arabic simple">
<li><p>Bad pixels are discarded from the background statistics.
If more than <span class="math notranslate nohighlight">\(50\%\)</span> of the pixels in a background mesh are bad, the local background value and the background standard deviation are replaced by interpolation of the nearest valid meshes.</p></li>
<li><p>The detection threshold <em>t</em> above the local sky background is adjusted for each pixel <em>i</em> with variance <span class="math notranslate nohighlight">\(\sigma^2_i\)</span>: <span class="math notranslate nohighlight">\(t_i=\)</span><code class="docutils literal notranslate"><span class="pre">DETECT_THRESH</span></code><span class="math notranslate nohighlight">\(\times\sqrt{\sigma^2_i}\)</span>, where <code class="docutils literal notranslate"><span class="pre">DETECT_THRESH</span></code> is expressed in units of standard deviations of the background noise.
Pixels with variance above the threshold set with the <code class="docutils literal notranslate"><span class="pre">WEIGHT_THRESH</span></code> parameter are therefore simply not detected.
This may result in splitting objects crossed by a group of bad pixels.
Interpolation should be used to avoid this problem.
If convolution filtering is applied for detection, the variance map is convolved too.
This yields optimum scaling of the detection threshold in the case where noise is uncorrelated from pixel to pixel.
Non-linear filtering operations (like those offered by artificial retinae) are not affected.</p></li>
<li><p>The cleaning process takes into account the exact individual thresholds assigned to each pixel for deciding about the fate of faint detections.</p></li>
<li><p>Error estimates like <code class="docutils literal notranslate"><span class="pre">FLUXISO_ERR</span></code> , <code class="docutils literal notranslate"><span class="pre">ERRA_IMAGE</span></code> , etc. also make use of individual variances.
Local background-noise standard deviation is simply set to <span class="math notranslate nohighlight">\(\sqrt{\sigma^2_i}\)</span>.
In addition, if the <code class="docutils literal notranslate"><span class="pre">WEIGHT_GAIN</span></code> parameter is set to <code class="docutils literal notranslate"><span class="pre">Y</span></code> (which is the default), it is assumed that the local pixel gain (i.e., the conversion factor from photo-electrons to ADUs) is inversely proportional to <span class="math notranslate nohighlight">\(\sigma^2_i\)</span>, the median value over the image being set by the <code class="docutils literal notranslate"><span class="pre">GAIN</span></code> configuration parameter.
In other words, it is then supposed that the changes in noise intensities seen over the images are due to gain changes.
This is the most common case: correction for vignetting, or coverage depth.
When this is not the case, for instance when changes are purely dominated by those of the read-out noise, <code class="docutils literal notranslate"><span class="pre">WEIGHT_GAIN</span></code> shall be set to <code class="docutils literal notranslate"><span class="pre">N</span></code>.</p></li>
<li><p>Finally, pixels with weights beyond <code class="docutils literal notranslate"><span class="pre">WEIGHT_THRESH</span></code> are treated just like pixels discarded by the masking process.</p></li>
</ol>
</section>
<section id="combining-weight-maps">
<h2>Combining weight maps<a class="headerlink" href="#combining-weight-maps" title="Link to this heading"></a></h2>
<p>All the weighting options listed in <a class="reference internal" href="#weight-map-format"><span class="std std-ref">Weight-map formats</span></a> can be applied separately to detection and measurement images (<a class="reference internal" href="Using.html#using-sextractor"><span class="std std-ref">Using SExtractor</span></a>), even if some combinations may not always make sense.
For instance, the following set of configuration lines:</p>
<p><code class="docutils literal notranslate"><span class="pre">WEIGHT_IMAGE</span></code> <em>rms.fits</em>, <em>weight.fits</em></p>
<p><code class="docutils literal notranslate"><span class="pre">WEIGHT_TYPE</span></code> <code class="docutils literal notranslate"><span class="pre">MAP_RMS</span></code>, <code class="docutils literal notranslate"><span class="pre">MAP_WEIGHT</span></code></p>
<p>will load the FITS file <em>rms.fits</em> and use it as an RMS map for adjusting the detection threshold and cleaning, while the <em>weight.fits</em> weight map will only be used for scaling the error estimates on measurements.
This can be done in single- as well as in dual-image mode (see <a class="reference internal" href="Using.html#using-sextractor"><span class="std std-ref">Using SExtractor</span></a>).
<code class="docutils literal notranslate"><span class="pre">WEIGHT_IMAGE</span></code> can be ignored for <code class="docutils literal notranslate"><span class="pre">BACKGROUND</span></code> <code class="docutils literal notranslate"><span class="pre">WEIGHT_TYPE</span></code>.
It is of course possible to use weight-maps for detection or for measurement only.
The following configuration:</p>
<p><code class="docutils literal notranslate"><span class="pre">WEIGHT_IMAGE</span></code> <em>weight.fits</em></p>
<p><code class="docutils literal notranslate"><span class="pre">WEIGHT_TYPE</span></code> <code class="docutils literal notranslate"><span class="pre">NONE</span></code>, <code class="docutils literal notranslate"><span class="pre">MAP_WEIGHT</span></code></p>
<p>will apply weighting only for measurements; detection and cleaning operations will remain unaffected.</p>
</section>
<section id="weight-map-flags-flags-weight">
<span id="flags-weight-def"></span><h2>Weight-map flags: <span class="param">FLAGS_WEIGHT</span><a class="headerlink" href="#weight-map-flags-flags-weight" title="Link to this heading"></a></h2>
<p>The <span class="param">FLAGS_WEIGHT</span> catalog parameter flags various issues which may happen during the weighting process (see the <a class="reference internal" href="Flagging.html#flagging"><span class="std std-ref">Flagging</span></a> section for details on how flags are managed in <strong class="program">SExtractor</strong>):</p>
<span id="flags-weight-table"></span><table class="docutils align-default" id="id3">
<caption><span class="caption-number">Table 2 </span><span class="caption-text"><span class="param">FLAGS_WEIGHT</span> description</span><a class="headerlink" href="#id3" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 4.8%" />
<col style="width: 95.2%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>at least one measurement-image weight with a value below <code class="docutils literal notranslate"><span class="pre">WEIGHT_THRESH</span></code> <em>overlaps</em> the isophotal footprint of the detected object</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>at least one measurement-image weight with a value below <code class="docutils literal notranslate"><span class="pre">WEIGHT_THRESH</span></code> <em>touches</em> the isophotal footprint of the detected object</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f1" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>The mesh-filtering procedures act on the variance map, too.</p>
</aside>
</aside>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Background.html" class="btn btn-neutral float-left" title="Modeling the background" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Flagging.html" class="btn btn-neutral float-right" title="Flagging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2023, CFHT/IAP/CNRS/SorbonneU.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>